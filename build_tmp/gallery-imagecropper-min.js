YUI.add("gallery-imagecropper",function(a){var e=a.Lang,h=e.isNumber,f=a.Array,c=a.ClassNameManager.getClassName,g="imagecropper",b="resize",d={cropMask:c(g,"mask"),resizeKnob:c(g,b,"knob"),resizeMask:c(g,b,"mask")};function i(){i.superclass.constructor.apply(this,arguments);}a.extend(i,a.Widget,{CROP_MASK_TEMPLATE:'<div class="'+d.cropMask+'"></div>',RESIZE_KNOB_TEMPLATE:'<div class="'+d.resizeKnob+'" tabindex="0"></div>',RESIZE_MASK_TEMPLATE:'<div class="'+d.resizeMask+'"></div>',CONTENT_TEMPLATE:"<img/>",CLASS_NAMES:d,_defCropMaskValueFn:function(){return a.Node.create(this.CROP_MASK_TEMPLATE);},_defResizeKnobValueFn:function(){return a.Node.create(this.RESIZE_KNOB_TEMPLATE);},_defResizeMaskValueFn:function(){return a.Node.create(this.RESIZE_MASK_TEMPLATE);},_defInitWidthSetter:function(k){var j=this.get("minHeight");return k<j?j:k;},_defInitHeightSetter:function(k){var j=this.get("minWidth");return k<j?j:k;},_defStatusGetter:function(){var j=this.resize?this.resize.get("resizing"):false,k=this.drag?this.drag.get("dragging"):false;return j||k;},_renderCropMask:function(j){var k=this.get("cropMask").addClass(this.CLASS_NAMES.cropMask);if(!k.inDoc()){j.append(k);}},_renderResizeKnob:function(j){var k=this.get("resizeKnob").addClass(this.CLASS_NAMES.resizeKnob);if(!k.inDoc()){j.append(k);}k.setStyle("backgroundImage","url("+this.get("source")+")");},_renderResizeMask:function(){var j=this.get("resizeMask").addClass(this.CLASS_NAMES.resizeMask);if(!j.inDoc()){this.get("resizeKnob").append(j);}},_handleSrcChange:function(j){this.get("contentBox").set("src",j.newVal);this.get("resizeKnob").setStyle("backgroundImage","url("+j.newVal+")");},_syncResizeKnob:function(){var j=this.get("initialXY");this.get("resizeKnob").setStyles({left:j[0],top:j[1],width:this.get("initWidth"),height:this.get("initHeight")});},_syncResizeMask:function(){var j=this.get("resizeKnob");j.setStyle("backgroundPosition",(-j.get("offsetLeft"))+"px "+(-j.get("offsetTop"))+"px");},_syncResizeAttr:function(k){var j=this.get("resizeKnob");if(j.resize){j.resize.con.set(k.attrName,k.newVal);}},_syncControlsVisibility:function(k){var j=!k.newVal,l=this.getClassName("controls","hidden");this.get("resizeKnob").toggleClass(l,j);this.get("cropMask").toggleClass(l,j);},_syncSize:function(j){this.get("cropMask").setStyle(j.attrName,j.newVal);this.get("contentBox").setStyle(j.attrName,j.newVal);},_icEventProxy:function(n,m,l){var k=m+":"+l,j=this.get("resizeKnob");n.on(k,function(p){var q={width:j.get("offsetWidth"),height:j.get("offsetHeight"),left:j.get("offsetLeft"),top:j.get("offsetTop")};q[m+"Event"]=p;this.fire(k,q);q.sourceEvent=k;this.fire("crop:"+(l==m?"crop":l),q);},this);},_bindResize:function(k,j){var l=this.resize=new a.Resize({node:k});l.on("resize:resize",this._syncResizeMask,this);l.plug(a.Plugin.ResizeConstrained,{constrain:j,minHeight:this.get("minHeight"),minWidth:this.get("minWidth"),preserveRatio:this.get("preserveRatio")});f.each(a.ImageCropper.RESIZE_EVENTS,a.bind(this._icEventProxy,this,l,"resize"));},_bindDrag:function(k,j){var l=this.drag=new a.DD.Drag({node:k,handles:[this.get("resizeMask")]});l.after("drag:drag",this._syncResizeMask,this);l.plug(a.Plugin.DDConstrained,{constrain2node:j});f.each(a.ImageCropper.DRAG_EVENTS,a.bind(this._icEventProxy,this,l,"drag"));},initializer:function(){this.set("initialXY",this.get("initialXY")||[10,10]);this.set("initWidth",this.get("initWidth"));this.set("initHeight",this.get("initHeight"));this.after("sourceChange",this._handleSrcChange);this.after("visibleControlsChange",this._syncControlsVisibility);this.after(["widthChange","heightChange"],this._syncSize);f.each(a.ImageCropper.RESIZE_ATTRS,function(j){this.after(j+"Change",this._syncResizeAttr);},this);},renderUI:function(){var j=this.get("boundingBox");this._renderCropMask(j);this._renderResizeKnob(j);this._renderResizeMask();},bindUI:function(){var k=this.get("contentBox"),j=this.get("resizeKnob");this._bindResize(j,k);this._bindDrag(j,k);},syncUI:function(){this.get("contentBox").set("src",this.get("source"));this._syncResizeKnob();this._syncResizeMask();this._syncControlsVisibility({newVal:this.get("visibleControls")});},getCropCoords:function(){var k=this.get("resizeKnob"),j,l;if(k.inDoc()){j={left:k.get("offsetLeft"),top:k.get("offsetTop"),width:k.get("offsetWidth"),height:k.get("offsetHeight")};}else{l=this.get("initialXY");j={left:l[0],top:l[1],width:this.get("initWidth"),height:this.get("initHeight")};}j.image=this.get("source");return j;},reset:function(){var j=this.get("initialXY");this.get("resizeKnob").setStyles({left:j[0],top:j[1],width:this.get("initWidth"),height:this.get("initHeight")});this._syncResizeMask();return this;},destructor:function(){if(this.resize){this.resize.destroy();}if(this.drag){this.drag.destroy();}this.drag=null;this.resize=null;}},{NAME:g,RESIZE_EVENTS:["start","resize","end"],RESIZE_ATTRS:["minWidth","minHeight","preserveRatio"],DRAG_EVENTS:["start","drag","end"],HTML_PARSER:{source:function(j){return j.get("src");},cropMask:"."+d.cropMask,resizeKnob:"."+d.resizeKnob,resizeMask:"."+d.resizeMask},ATTRS:{source:{value:""},resizeMask:{setter:a.one,valueFn:"_defResizeMaskValueFn"},resizeKnob:{setter:a.one,valueFn:"_defResizeKnobValueFn"},cropMask:{setter:a.one,valueFn:"_defCropMaskValueFn"},initialXY:{validator:e.isArray},status:{readOnly:true,getter:"_defStatusGetter"},minHeight:{value:50,validator:h},minWidth:{value:50,validator:h},preserveRatio:{value:false,validator:e.isBoolean},initHeight:{value:0,validator:h,setter:"_defInitHeightSetter"},initWidth:{value:0,validator:h,setter:"_defInitWidthSetter"},visibleControls:{value:true,validator:e.isBoolean}}});a.ImageCropper=i;},"@VERSION@",{requires:["widget","dd-drag","dd-constrain","resize-base","resize-constrain"],skinnable:true});